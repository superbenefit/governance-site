---
/**
 * CollectionList Component
 *
 * Displays a list of entries from a governance collection.
 * Used by index pages to show agreements, policies, or proposals.
 */
import { getCollection } from 'astro:content';
import { render } from 'astro:content';

interface Props {
	collection: 'agreements' | 'policies' | 'proposals';
}

const { collection } = Astro.props;

// Get all entries from the specified collection
const entries = await getCollection(collection);

// Sort by ID (alphabetically, which maintains directory structure)
const sortedEntries = entries.sort((a, b) => a.id.localeCompare(b.id));

// Group by top-level directory
const grouped = sortedEntries.reduce((acc, entry) => {
	const parts = entry.id.split('/');
	const group = parts.length > 1 ? parts[0] : '_root';
	if (!acc[group]) acc[group] = [];
	acc[group].push(entry);
	return acc;
}, {} as Record<string, typeof entries>);
---

<div class="collection-list">
	{Object.entries(grouped).map(([group, items]) => (
		<div class="collection-group">
			{group !== '_root' && (
				<h3 class="group-title">{group.charAt(0).toUpperCase() + group.slice(1)}</h3>
			)}
			<ul class="entry-list">
				{items.map(async (entry) => {
					const { headings } = await render(entry);
					const title = entry.data.title || headings.find(h => h.depth === 1)?.text || entry.id;
					const description = entry.data.description;

					return (
						<li class="entry-item">
							<a href={`/${collection}/${entry.id}/`} class="entry-link">
								<strong class="entry-title">{title}</strong>
								{description && <p class="entry-description">{description}</p>}
							</a>
							{entry.data.status && (
								<span class={`status-badge status-${entry.data.status}`}>
									{entry.data.status}
								</span>
							)}
						</li>
					);
				})}
			</ul>
		</div>
	))}
</div>

<style>
	.collection-list {
		margin: var(--sb-space-8) 0;
	}

	.collection-group {
		margin-bottom: var(--sb-space-10);
	}

	.group-title {
		font-size: var(--text-2xl, 1.5rem);
		margin-bottom: var(--sb-space-4);
		color: var(--sl-color-gray-6);
		border-bottom: 1px solid var(--sl-color-gray-5);
		padding-bottom: var(--sb-space-2);
	}

	.entry-list {
		list-style: none;
		padding: 0;
		display: grid;
		gap: var(--sb-space-4);
	}

	.entry-item {
		background: var(--sb-surface);
		border: 1px solid var(--sb-border);
		border-radius: var(--sb-radius-lg);
		padding: var(--sb-space-6);
		box-shadow: var(--sb-shadow-sm);
		transition: all var(--sb-transition-base);
		position: relative;
	}

	.entry-item:hover {
		border-color: var(--sb-primary);
		box-shadow: var(--sb-shadow-md);
		transform: translateY(-2px);
	}

	.entry-link {
		text-decoration: none;
		color: inherit;
		display: block;
	}

	.entry-title {
		color: var(--sl-color-gray-6);
		font-size: var(--text-lg, 1.125rem);
		font-weight: 600;
		display: block;
		margin-bottom: var(--sb-space-2);
		transition: color var(--sb-transition-fast);
	}

	.entry-link:hover .entry-title {
		color: var(--sb-primary);
	}

	.entry-description {
		color: var(--sl-color-gray-4);
		margin: 0;
		font-size: var(--text-sm, 0.875rem);
		line-height: 1.5;
	}

	.status-badge {
		position: absolute;
		top: var(--sb-space-6);
		right: var(--sb-space-6);
		font-size: var(--text-xs, 0.75rem);
		padding: var(--sb-space-1-5) var(--sb-space-3);
		border-radius: var(--sb-radius-full);
		text-transform: uppercase;
		font-weight: 600;
		letter-spacing: 0.025em;
	}

	/* SuperBenefit Brand Colors for Status Badges */
	.status-draft {
		background: var(--sb-text-highlight);  /* Orange at 10% opacity */
		color: var(--sb-tertiary);             /* Rust */
		border: 1px solid var(--sb-accent-warm);
	}

	.status-active {
		background: var(--sb-highlight);       /* Sage at 15% opacity */
		color: var(--sb-primary-dark);         /* Sage dark */
		border: 1px solid var(--sb-primary-light);
	}

	.status-deprecated {
		background: var(--sb-border);          /* Light gray */
		color: var(--sb-gray);                 /* Medium gray */
		border: 1px solid var(--sb-lightgray);
	}

	/* Dark mode adjustments */
	[data-theme="dark"] .entry-item {
		background: var(--sl-color-gray-2);
	}

	[data-theme="dark"] .group-title {
		color: var(--sl-color-gray-1);
	}

	[data-theme="dark"] .entry-title {
		color: var(--sl-color-gray-1);
	}
</style>
