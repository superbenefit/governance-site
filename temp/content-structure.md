# Content Structure

## Architecture Overview

This site uses a **submodule + loader architecture**:
- Content lives in [superbenefit/governance](https://github.com/superbenefit/governance) repository
- Integrated as git submodule at `src/content/governance/`
- Custom Astro content loaders dynamically generate pages
- Single source of truth maintained in governance repo

## Directory Structure

```
src/content/
â”œâ”€â”€ docs/                        # Site pages and index templates
â”‚   â”œâ”€â”€ index.mdx                # Landing page (splash template)
â”‚   â”œâ”€â”€ agreements/
â”‚   â”‚   â””â”€â”€ index.md             # Pre-made index (integrates with loader)
â”‚   â”œâ”€â”€ policies/
â”‚   â”‚   â””â”€â”€ index.md             # Pre-made index (integrates with loader)
â”‚   â””â”€â”€ proposals/
â”‚       â””â”€â”€ index.md             # Pre-made index (integrates with loader)
â”‚
â””â”€â”€ governance/                  # Git submodule (source content)
    â”œâ”€â”€ agreements/              # Loaded by agreements collection
    â”‚   â”œâ”€â”€ index.md
    â”‚   â”œâ”€â”€ community/
    â”‚   â”‚   â””â”€â”€ [agreement-files].md
    â”‚   â””â”€â”€ dao/
    â”‚       â””â”€â”€ [agreement-files].md
    â”œâ”€â”€ policies/                # Loaded by policies collection
    â”‚   â”œâ”€â”€ index.md
    â”‚   â”œâ”€â”€ metagovernance/
    â”‚   â”œâ”€â”€ operations/
    â”‚   â””â”€â”€ platforms/
    â”œâ”€â”€ proposals/               # Loaded by proposals collection
    â”‚   â”œâ”€â”€ index.md
    â”‚   â””â”€â”€ [proposal-files].md
    â”œâ”€â”€ GOVERNANCE.md            # Root page content
    â”œâ”€â”€ CODE_OF_CONDUCT.md       # Root page content
    â””â”€â”€ CONTRIBUTING.md          # Root page content
```

## Pages

### Main Index (Landing Page)
**Location**: `src/content/docs/index.mdx`
**Template**: Starlight splash template
**Purpose**: Hero landing page introducing SuperBenefit governance

**Features**:
- Hero section with governance tagline
- Card grid linking to three main sections
- Call-to-action for participation
- Minimal navigation (splash removes sidebar)

### Section Index Pages
**Locations**: 
- `src/content/docs/agreements/index.md`
- `src/content/docs/policies/index.md`
- `src/content/docs/proposals/index.md`

**Architecture**: Pre-made templates that integrate with loader-generated content

**Purpose**: 
- Provide overview and context for each section
- Display dynamically generated list of documents from loader
- Explain section purpose and usage

**Implementation Pattern**:
```markdown
---
title: Agreements
description: Relational foundations that define how we work together
---

[Introductory prose explaining agreements...]

## Current Agreements

<!-- Dynamic list of agreements generated by loader -->
<!-- Loader provides: title, description, last updated, status -->
```

### Root Pages
**Sources**: Loaded dynamically from submodule
- `governance.md` â†’ loaded from `src/content/governance/GOVERNANCE.md`
- `code-of-conduct.md` â†’ loaded from `src/content/governance/CODE_OF_CONDUCT.md`
- `contributing.md` â†’ loaded from `src/content/governance/CONTRIBUTING.md`

**Purpose**: Core governance documentation accessible at root level

**Loader Behavior**: 
- Read from submodule location
- Generate routes at root of docs
- Apply appropriate frontmatter/schema
- Enable standard Starlight page features

### Content Pages (Dynamic)
**Sources**: Generated by content loaders from submodule

**Agreements**:
- Individual agreements from `src/content/governance/agreements/**/*.md`
- Nested subdirectories (community/, dao/) preserved in routes
- Example: `agreements/dao/operating-agreement.md`

**Policies**:
- Individual policies from `src/content/governance/policies/**/*.md`
- Nested subdirectories (metagovernance/, operations/, platforms/) preserved
- Example: `policies/operations/treasury-management.md`

**Proposals**:
- Individual proposals from `src/content/governance/proposals/**/*.md`
- Flat structure (no subdirectories currently)
- Example: `proposals/sbp-001-initial-structure.md`

## Content Collections

### Three Main Collections

Each section has its own content collection with a custom loader:

**agreements Collection**:
```typescript
{
  loader: governanceLoader('agreements'),
  schema: agreementSchema
}
```

**policies Collection**:
```typescript
{
  loader: governanceLoader('policies'),
  schema: policySchema
}
```

**proposals Collection**:
```typescript
{
  loader: governanceLoader('proposals'),
  schema: proposalSchema
}
```

### Loader Implementation

**Purpose**: Read markdown files from submodule, parse frontmatter, generate routes

**Key Functions**:
1. Scan submodule directory recursively
2. Read markdown files and extract frontmatter
3. Parse content and validate against schema
4. Generate route slugs preserving directory structure
5. Provide data to Starlight for page generation

**Schema Requirements**:
```typescript
{
  title: string,           // Required: Document title
  description: string,     // Required: SEO description
  status?: string,         // Optional: draft, active, deprecated
  lastUpdated?: Date,      // Optional: Last modified date
  tags?: string[],         // Optional: Classification tags
  relatedDocs?: string[],  // Optional: Links to related documents
}
```

## Navigation

### Sidebar Structure

```
ğŸ  SuperBenefit Governance (landing page)

â”œâ”€â”€ ğŸ“‹ Agreements (autogenerated group)
â”‚   â”œâ”€â”€ Overview (index)
â”‚   â”œâ”€â”€ Community Agreements (group)
â”‚   â”‚   â””â”€â”€ [agreement documents]
â”‚   â””â”€â”€ DAO Agreements (group)
â”‚       â””â”€â”€ [agreement documents]
â”‚
â”œâ”€â”€ ğŸ“ Policies (autogenerated group)
â”‚   â”œâ”€â”€ Overview (index)
â”‚   â”œâ”€â”€ Metagovernance (group)
â”‚   â”‚   â””â”€â”€ [policy documents]
â”‚   â”œâ”€â”€ Operations (group)
â”‚   â”‚   â””â”€â”€ [policy documents]
â”‚   â””â”€â”€ Platforms (group)
â”‚       â””â”€â”€ [policy documents]
â”‚
â”œâ”€â”€ ğŸ“ Proposals (autogenerated group)
â”‚   â”œâ”€â”€ Overview (index)
â”‚   â””â”€â”€ [proposal documents]
â”‚
â””â”€â”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (visual separator)
    â”œâ”€â”€ Governance Framework (de-emphasized)
    â”œâ”€â”€ Code of Conduct (de-emphasized)
    â””â”€â”€ Contributing (de-emphasized)
```

### Visual Hierarchy

**Main Sections** (Agreements, Policies, Proposals):
- Prominent positioning (top of sidebar)
- Icon or badge styling
- Expanded by default
- Standard font weight

**Root Pages** (Governance, Code of Conduct, Contributing):
- Below main sections with visual separator
- De-emphasized styling (lighter text, smaller font, or reduced opacity)
- Extra spacing above to create visual break
- Clearly secondary in hierarchy

**Implementation**:
- Use Starlight's sidebar groups with autogenerate
- Apply custom CSS classes for de-emphasized items
- Configure collapsed state for root pages section

## Frontmatter Requirements

### Required Fields (All Documents)
```yaml
---
title: Document Title
description: Brief description for SEO and previews
---
```

### Optional Fields
```yaml
---
status: active | draft | deprecated
lastUpdated: 2025-11-05
tags: [coordination, operations, community]
relatedDocs:
  - /agreements/dao/operating-agreement
  - /policies/operations/treasury-management
---
```

### Index Pages (Special)
```yaml
---
title: Section Title
description: Section overview
template: doc  # or splash if needed
sidebar:
  order: 0     # Ensures it appears first
---
```

## Dynamic Content Integration

### How Index Pages Slot Content

Index pages are **pre-made templates** that integrate with **loader-generated content**:

1. **Template Content**: Written prose explaining the section (static)
2. **Dynamic List**: Generated by loader, inserted into template (dynamic)
3. **Integration**: Use Astro components or custom logic to merge

**Example Pattern**:
```astro
---
// agreements/index.md
title: Agreements
---

Agreements are the relational foundations that define how SuperBenefit community
members work together. They establish shared understanding while preserving
individual autonomy.

## Current Agreements

<AgreementList collection="agreements" />

<!-- Component fetches loader data and renders:
  - Agreement title + description
  - Status badge
  - Last updated date
  - Link to full document
-->
```

### Loader Update Workflow

When governance content changes:

1. **Content Updated**: Changes committed to governance repo
2. **Submodule Update**: In site repo, run `git submodule update --remote`
3. **Rebuild Triggered**: CI/CD or local build picks up changes
4. **Loaders Execute**: Read updated content from submodule
5. **Pages Regenerated**: New/updated routes created automatically
6. **Deploy**: Updated site deployed with fresh content

### Benefits of This Architecture

- **Single Source**: Governance repo is authoritative
- **Automatic Sync**: Submodule updates trigger rebuilds
- **Type Safety**: Schema validation prevents malformed content
- **Flexibility**: Add new documents without site code changes
- **Separation**: Content (governance) vs. presentation (site)
- **Contributor UX**: Content contributors work in governance repo, not site repo

## Implementation Notes

### Content Collection Config Location
`src/content.config.ts`

### Loader Function Location
Options:
1. Inline in `content.config.ts` (simple loaders)
2. Separate file: `src/loaders/governance.ts` (complex loaders)

### Testing Loaders
```bash
# Verify submodule initialized
git submodule status

# Update submodule to latest
git submodule update --remote

# Run dev server and check routes
npm run dev

# Build and verify output
npm run build
```

### Handling Nested Directories

Loaders must preserve directory structure in route slugs:
- `governance/agreements/community/collaboration.md` 
  â†’ route: `/agreements/community/collaboration/`
- `governance/policies/operations/treasury.md`
  â†’ route: `/policies/operations/treasury/`

### Future Extensibility

This architecture supports:
- Adding new sections (create loader + collection)
- Changing content structure (update loader logic)
- Adding new fields (extend schema)
- Custom page types (modify loader output)
- Alternative content sources (swap loader implementation)
